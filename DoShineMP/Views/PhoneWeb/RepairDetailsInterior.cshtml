
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <link href="~/Styles/rest.css" rel="stylesheet" />
    <link href="~/Styles/RepairDetails.css" rel="stylesheet" />
    <link href="~/dev/css/mobiscroll.core-2.5.2.css" rel="stylesheet" />
    <link href="~/dev/css/mobiscroll.animation-2.5.2.css" rel="stylesheet" />
    <link href="~/dev/css/mobiscroll.android-ics-2.5.2.css" rel="stylesheet" />
    <link href="~/Styles/star-rating.css" rel="stylesheet" />
    <link href="~/Styles/footer.css" rel="stylesheet" />
    <style>
        .android-ics.light .dwbc {
            background-color: #4ca329;
        }

        .android-ics.light .dwb {
            color: white;
        }

        .android-ics .dw .dwb-a {
            background-color: #3F901F;
        }

        :-moz-placeholder { /* Mozilla Firefox 4 to 18 */
            color: #cdcdcd;
        }

        ::-moz-placeholder { /* Mozilla Firefox 19+ */
            color: #cdcdcd;
        }

        input:-ms-input-placeholder,
        textarea:-ms-input-placeholder {
            color: #cdcdcd;
        }

        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            color: #cdcdcd;
        }

        .state {
            background-color: #f3f4ef;
            padding: 0 20px;
        }

        .Ani li {
            top: 45px;
        }

        .state-box {
            background-color: white;
            padding-top: 22px;
            padding-left: 35px;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
        }

        .list-bottom {
            padding: 15px 15px 15px;
            background-color: white;
            overflow: hidden;
        }

        .bg-box {
            box-shadow: 2px 2px 5px 0px #555353;
            margin-top: 6px;
            border-radius: 5px;
            overflow: hidden;
        }

        .state-box-l {
            float: left;
            display: block;
            width: 28px;
            height: 28px;
        }

        .state-box-r {
            padding-left: 40px;
        }

            .state-box-r p:nth-child(1) {
                font-size: 18px;
                color: #333;
            }

            .state-box-r p:nth-child(2) {
                font-size: 14px;
                color: #9c9c9c;
            }

        .state-box-l img {
            width: 100%;
            height: 100%;
            margin-top: 6px;
        }

        .Ani li:nth-child(2) {
            left: 35%;
        }

        .Ani li:nth-child(1) {
            left: 18%;
        }

        .Ani li:nth-child(3) {
            left: 55%;
        }

        .Ani li:nth-child(4) {
            right: 17%;
        }

        .indent-title {
            padding: 6px 0px 14px;
        }

        .informant-title {
            margin-bottom: 10px;
        }

        .informant .informant-title p {
            line-height: 45px;
            color: #333;
        }

        .silmebr {
            display: block;
            border-top: 1px solid #ddd;
            transform: scale(1,0.5);
            -webkit-transform: scale(1,0.5);
        }

        .top-content {
            padding-top: 10px;
        }

        .operate {
            display: table;
            text-align: center;
        }

        .choose-photo img {
            width: 80px;
            height: 80px;
        }

        #sitea {
            position: fixed;
            bottom: 0px;
            left: 0px;
            border: 1px solid #ddd;
            padding-top: 0;
            /*padding-bottom: 15px;*/
            height: 66px;
            padding-left: 10px;
            padding-right: 10px;
            background-color: #fff;
            z-index: 22;
        }

            #sitea input {
                width: 45%;
            }

        #senm .service li {
            float: left;
            padding: 5px 10px;
            background-color: white;
            color: #1ec462;
            border-radius: 15px;
            margin-right: 5px;
            transition: all .6s linear 0s;
            -webkit-transition: all .6s linear 0s;
            border: 0;
            margin-top: 2px;
        }

        #reset {
            text-align: left;
            padding: 0;
        }

            #reset .rating-sm {
                font-size: 1em;
            }

        #choose-photo > div {
            display: inline-block;
            position: relative;
        }

            #choose-photo > div > .imgdiv_cancle {
                position: absolute;
                top: 0%;
                width: 30%;
                height: 30%;
                right: -5%;
                z-index: 9999999;
            }
    </style>
}
<div class="keep-list">
    <div class="keep-list-in">
        @* 顶部 *@
        <div class="list-bottom" style="background-color:#318fe7; margin-top:0;">
            <div class="bg-box">
                <div class="state-box">
                    @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Apply)
                    {
                    <div class="state-box-l"><img src="~/Images/40x40/commit.png" /></div>
                    <div class="state-box-r">
                        <p>订单已提交</p>
                        <p>请尽快联系客户处理订单</p>
                    </div>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Accept)
                    {
                    <div class="state-box-l"><img src="~/Images/40x40/shouli.png" /></div>
                    <div class="state-box-r">
                        <p>订单已受理</p>
                        <p>请在 @ViewBag.RepairDetail.ExceptHandleDate 前上门服务</p>
                    </div>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.FinishHandle)
                    {
                    <div class="state-box-l"><img src="~/Images/40x40/queren.png" /></div>
                    <div class="state-box-r">
                        <p>订单待确认</p>
                        <p>该订单已完成，等待用户评价</p>
                    </div>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Finish)
                    {
                    <div class="state-box-l"><img src="~/Images/40x40/finish.png" /></div>
                    <div class="state-box-r" style="padding-bottom:20px;">
                        <p>订单已完成</p>
                        <div class="keep-textarea" id="reset">
                            <input id="input-21d" value="@ViewBag.RepairDetail.Score" type="number" class="rating" min=0 max=5 step=1 data-size="sm" disabled="disabled">
                        </div>
                        <p style="color:#898989;">@ViewBag.RepairDetail.Response</p>
                    </div>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Cancel)
                    {
                    <div class="state-box-l"><img src="~/Images/40x40/cancle.png" /></div>
                    <div class="state-box-r">
                        <p>订单已取消</p>
                        <p>抱歉，该订单已取消</p>
                    </div>
                    }
                </div>
                <div class="state">
                    @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Apply)
                    {
                    <div class="state-in">
                        <ul class="state-ul">
                            <li class="current"></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                        <span class="line"></span>
                        <span class="line-current"></span>
                    </div>
                    <ul class="state-time Ani">
                        <li class="current">提交</li>
                        <li>受理</li>
                        <li>确认</li>
                        <li>完成</li>
                    </ul>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Accept)
                    {
                    <div class="state-in">
                        <ul class="state-ul">
                            <li class="current"></li>
                            <li class="current"></li>
                            <li></li>
                            <li></li>
                        </ul>
                        <span class="line"></span>
                        <span class="line-current left-one"></span>
                    </div>
                    <ul class="state-time Ani">
                        <li class="current">提交</li>
                        <li class="current">受理</li>
                        <li>确认</li>
                        <li>完成</li>
                    </ul>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.FinishHandle)
                    {
                    <div class="state-in">
                        <ul class="state-ul">
                            <li class="current"></li>
                            <li class="current"></li>
                            <li class="current"></li>
                            <li></li>
                        </ul>
                        <span class="line"></span>
                        <span class="line-current left-two"></span>
                    </div>
                    <ul class="state-time Ani">
                        <li class="current">提交</li>
                        <li class="current">受理</li>
                        <li class="current">确认</li>
                        <li>完成</li>
                    </ul>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Finish)
                    {
                    <div class="state-in">
                        <ul class="state-ul">
                            <li class="current"></li>
                            <li class="current"></li>
                            <li class="current"></li>
                            <li class="current"></li>
                        </ul>
                        <span class="line"></span>
                        <span class="line-current left-two"></span>
                    </div>
                    <ul class="state-time Ani">
                        <li class="current">提交</li>
                        <li class="current">受理</li>
                        <li class="current">确认</li>
                        <li class="current">完成</li>
                    </ul>
                    }
                    else if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Cancel)
                    {
                    <div class="state-in">
                        <ul class="state-ul">
                            <li></li>
                            <li></li>
                            <li></li>
                            <li class="quxiao" style="background-image:url(../../doshinemp/Images/quxiao.jpg)"></li>
                        </ul>
                        <span class="line"></span>
                        <span class=""></span>
                    </div>
                    <ul class="state-time Ani">
                        <li>提交</li>
                        <li>受理</li>
                        <li>确认</li>
                        <li style="color:#f1514e;">取消</li>
                    </ul>
                    }

                </div>
            </div>
        </div>

        @* 取消原因 *@
        @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Cancel)
        {
            if (ViewBag.RepairDetail.Response != null && ViewBag.RepairDetail.Response != "")
            {
                <div class="list-top " style="margin:10px 0px">
                    <div class="nodal-c-title"><p class="text-left ">取消原因</p><p class="text-right" style="color:#a8a8a8;"></p></div>
                    <ins class="silmebr"></ins>
                    <div class="" style="padding-top:15px;">
                        <p style="font-size:14px;">@ViewBag.RepairDetail.Response</p>
                    </div>
                </div>
            }
        }


        @*企业维修反馈填写*@
        @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Accept)
        {
            <div class="choose ">
                <h4>请选择处理状态:</h4>
                <ul class="service" id="RepairFinishTypeid" style="border:0px">
                    <li class="current" typeid="Fixed">已修复</li>
                    <li typeid="Unfixed">未修复</li>
                    <li typeid="OutOfRange">不属于维保范围</li>
                </ul>
                <ins class="silmebr"></ins>
                <div class="choose-title">
                    <textarea class="choose-input" placeholder="请描述现场处理概况..." id="describe"></textarea>
                    <div class="choose-photo" id="choose-photo">

                        <img src="~/Images/tianjia2x.png" class="add-photo" id="add-photo">
                    </div>
                </div>
                <div style="margin-top:20px;margin-bottom:-10px;color:red;display:none;" id="messagetitle">请填写现场处理概况!</div>
            </div>

        }

        @*确认完成*@
        @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Accept)
        {
            <div class="col-xs-12 operate " id="sitea">
                <input type="button" class="commit pull-right applybtn" id="applybtn" tag="2" value="确认完成">
                @*取消按钮*@
                <input type="button" class="commit pull-left" @*id="applybtn1"*@ value="取消" style="background-color:#dedede" data-toggle="modal" data-target=".bs-example-modal-sm">
            </div>
        }

        @*企业维修反馈展示*@
        @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.FinishHandle || ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Finish)
        {
            <div class="choose " id="senm">
                <div style="position:relative;">
                    <h4>维修反馈:</h4>
                    <ul class="service" id="RepairFinishTypeid" style="border:none;padding-bottom:0;position:absolute;top:5px;right:-15px">
                        @if (ViewBag.RepairDetail.FinishType == DoShineMP.Models.RepairFinishType.Fixed)
                        {
                        <li typeid="Fixed">已修复</li>
                        }
                        else if (ViewBag.RepairDetail.FinishType == DoShineMP.Models.RepairFinishType.Unfixed)
                        {
                        <li typeid="Unfixed">未修复</li>
                        }
                        else if (ViewBag.RepairDetail.FinishType == DoShineMP.Models.RepairFinishType.OutOfRange)
                        {
                        <li typeid="OutOfRange">不属于维保范围</li>
                        }
                    </ul>
                    <ins class="silmebr"></ins>
                </div>
                <div class="choose-title">
                    @if (ViewBag.RepairDetail.Describe != null && ViewBag.RepairDetail.Describe != "")
                    {
                    <p class="back-content">
                        @ViewBag.RepairDetail.Describe
                    </p>
                    }
                    @if (ViewBag.RepairDetail.FinishImageFiles != null)
                    {
                    <div class="choose-photo" id="choose-photo">
                        @foreach (DoShineMP.Models.ImageFile i in ViewBag.RepairDetail.FinishImageFiles as List<DoShineMP.Models.ImageFile>)
                            {
                            <img src="@System.Configuration.ConfigurationManager.AppSettings["httpimgpath"]@i.FileName" class="imgyulan" />
                            }
                    </div>
                    }
                </div>
            </div>
        }

        @*订单内容*@
        <div class="list-top">
            <p class="indent-title">订单信息</p>
            <ins class="silmebr"></ins>
            <div class="top-content">
                <p>@(new MvcHtmlString(ViewBag.RepairDetail.Contenet))</p>
                @if (ViewBag.RepairDetail.ImageFiles != null)
                {
                <div class="img-content">
                    @foreach (DoShineMP.Models.ImageFile I in ViewBag.RepairDetail.ImageFiles as List<DoShineMP.Models.ImageFile>)
                        {

                        <img src="@System.Configuration.ConfigurationManager.AppSettings["httpimgpath"]@I.FileName" class="imgyulan" />

                        }
                </div>
                }
            </div>
        </div>

        @*个人信息*@
        <div class="informant">
            <div class="informant-title">
                <p>个人信息</p>
                <ins class="silmebr"></ins>
            </div>
            <p><span>手机号：</span><a href="tel:@ViewBag.RepairDetail.PhoneNumber">@ViewBag.RepairDetail.PhoneNumber</a></p>
            @if (ViewBag.RepairDetail.Name != null)
            {
            <p><span>申请客户：</span>@ViewBag.RepairDetail.Name </p>
            }
            else
            {
            <p><span>申请客户：</span> </p>
            }
            <p><span>报修时间：</span>@(ViewBag.RepairDetail.CreateDate != null ? ViewBag.RepairDetail.CreateDate : "")</p>
            <p><span>客户地址：</span>@(ViewBag.RepairDetail.Village.Name != null ? ViewBag.RepairDetail.Village.Name : "")</p>
            <p><span>订单号码：</span>@(ViewBag.RepairDetail.InnerNumber != null ? ViewBag.RepairDetail.InnerNumber : "")</p>
        </div>

        @*选择受理时间*@
        @if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Apply)
        {
            <div class="content">
                <div class="demos">
                    <input type="text" name="appDateTime" id="appDateTime" placeholder="点击选择上门处理时间" />
                </div>
                <div class="col-xs-12 operate " style="margin-bottom:20px;">
                    <input type="button" class="commit pull-right applybtn" id="applybtn" tag="1" value="受理">
                    @*取消按钮*@
                    <input type="button" class="commit pull-right" @*id="applybtn1"*@ value="取消" style="background-color:#dedede" data-toggle="modal" data-target=".bs-example-modal-sm">
                </div>

            </div>
        }


    </div>
</div>

<!-- Modal -->


<input type="hidden" value="@ViewBag.RepairDetail.RepairId" id="repairID" />
<input type="hidden" value="" id="serviceid" />


<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" style="padding-top:35%;">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body">
                <textarea class="choose-input" placeholder="请填写取消原因..." id="reasontext" style="border:none;width:100%;"></textarea>
            </div>
            <div class="modal-footer">
                <span class="pull-left" style="color:red;" id="querentext"></span>
                <button type="button" class="btn btn-default" data-dismiss="modal" id="modalquxiao">取消</button>
                <button type="button" class="btn btn-primary" id="applybtn1">确认</button>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <p><img src="~/Images/logo22.png" /></p>
    <p class="service">Powered By Doshine.com</p>
</div>

@if (ViewBag.RepairDetail.Status == DoShineMP.Models.RepairStatus.Accept)
{
    <div style="height:65px;"></div>
}
<input type="hidden" value="@DateTime.Now" id="NowDateTime" />





@section scripts{
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="~/dev/js/mobiscroll.core-2.5.2.js"></script>
    <script src="~/dev/js/mobiscroll.core-2.5.2-zh.js"></script>
    <script src="~/dev/js/mobiscroll.datetime-2.5.1.js"></script>
    <script src="~/dev/js/mobiscroll.datetime-2.5.1-zh.js"></script>
    <script src="~/dev/js/mobiscroll.android-ics-2.5.2.js"></script>
    <script src="~/Scripts/star-rating.js"></script>
    <script src="~/Scripts/sucai.js"></script>
    <script type="text/javascript">
        var token;
        var imglength = 3;
        var maximglength = 3;
        var images = {
            localId: [],
            serverId: []
        };
        $(function () {
            //$('#add-photo').hide();
            $.post('@Url.Action("WechatJsConfigJson","PhoneWeb")', { url: window.location.href }, function (data, status) {
                var debug = data.debug;
                var appId = data.appId;
                var timestamp = data.timestamp;
                var nonceStr = data.nonceStr;
                var signature = data.signature

                wx.config({
                    debug: debug,
                    appId: appId,
                    timestamp: timestamp,
                    nonceStr: nonceStr,
                    signature: signature,
                    jsApiList: [
                        'checkJsApi',
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage',
                    'onMenuShareQQ',
                    'onMenuShareWeibo',
                    'hideMenuItems',
                    'showMenuItems',
                    'hideAllNonBaseMenuItem',
                    'showAllNonBaseMenuItem',
                    'translateVoice',
                    'startRecord',
                    'stopRecord',
                    'onRecordEnd',
                    'playVoice',
                    'pauseVoice',
                    'stopVoice',
                    'uploadVoice',
                    'downloadVoice',
                    'chooseImage',
                    'previewImage',
                    'uploadImage',
                    'downloadImage',
                    'getNetworkType',
                    'openLocation',
                    'getLocation',
                    'hideOptionMenu',
                    'showOptionMenu',
                    'closeWindow',
                    'scanQRCode',
                    'chooseWXPay',
                    'openProductSpecificView',
                    'addCard',
                    'chooseCard',
                    'openCard'
                    ]
                });
            })
            // 微信
            wx.error(function (res) {
                console.log('验证失败');
            });
            wx.ready(function () {
                // 5 图片接口
                // 5.1 拍照、本地选图
                var images = {
                    localId: [],
                    serverId: []
                };

                $('#add-photo').click(function () {
                    wx.chooseImage({
                        count: imglength,
                        success: function (res) {
                            images.localId = res.localIds;
                            if (images.localId.length == 0) {
                                //alert('请先使用 chooseImage 接口选择图片');
                                return;
                            }
                            var i = 0, length = 3;
                            images.serverId = [];
                            var str = '';
                            var htmlstr = '';
                            function upload() {
                                wx.uploadImage({
                                    localId: images.localId[i],
                                    success: function (res) {
                                        images.serverId.push(res.serverId);
                                        if (i < length) {
                                            if (i == 0 && imglength == length) {
                                                $("#serviceid").val($("#serviceid").val() + res.serverId);
                                            } else {
                                                $("#serviceid").val($("#serviceid").val() + ',' + res.serverId);
                                            }
                                            ////alert(imglength);
                                            //htmlstr = '<img src="' + images.localId[i] + '" class="imgyulan11"  />';
                                            htmlstr = '<div src="' + images.localId[i] + '"><img src="' + images.localId[i] + '" serverId="' + res.serverId + '" class="imgyulan1"  /><img src="../../doshinemp/Images/40x40/cancle.png" class="imgdiv_cancle" /></div>'
                                            i++;
                                            $('#choose-photo').prepend(htmlstr);
                                            imglength--;
                                            if (imglength == 0) {
                                                $('#add-photo').hide();
                                                return;
                                            }
                                            upload();
                                        }
                                    },
                                    fail: function (res) {
                                    }
                                });
                            }
                            upload();

                        }
                    });
                })

            });
        })

        //初始化时间控件
        $(".form_datetime").datetimepicker({ format: 'yyyy-mm-dd hh:ii' });

        jQuery(document).ready(function () {
            $(".rating-kv").rating();
        });

        $('.applybtn').click(function () {
            $(this).attr('disabled', true);
            var repaidID = $('#repairID').val();
            var exceptDate = $('#appDateTime').val();
            var innderNumber = $('#input-21d').val();
            var type = $(this).attr('tag');
            var serviceid = $('#serviceid').val();
            var describe = $('#describe').val();
            var RepairFinishTypeid = $('#RepairFinishTypeid').find('.current').attr('typeid');

            if (type == '1') {//受理
                if ($('#appDateTime').val() == '' || $('#appDateTime').val() == null) {
                    //if ($('#appDateTime').hasClass('animated')) {
                    //    console.log(1)
                    //    $('#appDateTime')[0].className = "";
                    //    $('#appDateTime').addClass('animated2');
                    //}
                    //else {
                    //    $('#appDateTime')[0].className = "";

                    //    $('#appDateTime').addClass('animated');
                    //}
                    var inst = $('#appDateTime').mobiscroll('getInst');
                    inst.show();

                    //var time = document.getElementById('appDateTime');
                    //convertStyle(time);
                    //shake(time);

                    $(this).attr('disabled', false);
                    return;
                }
                ////alert(windowlength);
                $.post('@Url.Action("RepairDetailJson", "PhoneWeb")', { repaidID: repaidID, exceptDate: exceptDate, innderNumber: innderNumber, type: type }, function (data, status) {
                    if (status === 'success') {
                        if (data.msg != 'N') {
                            windowlength = window.history.length;
                            ////alert(windowlength);
                            if (windowlength == 1) {
                                window.localStorage['IndexLi'] = 1;
                                window.location.replace('@Url.Action("RepairInterior","PhoneWeb")?IndexLi=1');
                            } else {
                                window.localStorage['IndexLi'] = new Number(window.localStorage['IndexLi']) + 1;
                                window.history.go(-1);
                            }
                        }
                    }
                })
            } else if (type == '2') {//确认完成
                if (describe == null || describe == '') {
                    $('#messagetitle').show();
                    $(this).attr('disabled', false);
                    return false;
                }

                $.post('@Url.Action("RepairDetailWJson", "PhoneWeb")', { repaidID: repaidID, serviceid: serviceid, describe: describe, type: RepairFinishTypeid }, function (data, status) {
                    if (status === 'success') {
                        if (data.msg != 'N') {
                            windowlength = window.history.length;
                            //alert(windowlength);
                            if (windowlength == 1) {
                                window.localStorage['IndexLi'] = 2;
                                window.location.replace('@Url.Action("RepairInterior","PhoneWeb")?IndexLi=2');
                            } else {
                                window.localStorage['IndexLi'] = new Number(window.localStorage['IndexLi']) + 1;
                                window.history.go(-1);
                            }
                        }
                    }
                })
            }

        })

        $('#describe').focus(function () {
            $('#messagetitle').hide();
        })


        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }

        //删除上传图片
        $(document).on('click', '.imgdiv_cancle', function () {
            var serveridvalue = $('#serviceid').val();
            var serverId = $(this).prev().attr('serverId');
            if ($('#choose-photo').find('div').length == maximglength) {
                $(this).parent().remove();
                $('#add-photo').show();
            } else {
                $(this).parent().remove();
            }
            if (serveridvalue == serverId) {
                serveridvalue = '';
            } else if (!serveridvalue.indexOf(serverId)) {
                serveridvalue = serveridvalue.replace(serverId + ',', '');
            } else if (serveridvalue.length > serverId.length) {
                serveridvalue = serveridvalue.replace(',' + serverId, '');
            } else {
                serveridvalue = serveridvalue.replace(serverId, '');
            }
            $('#serviceid').val(serveridvalue)
            imglength++;
        })


        //微信多图轮播
        $(document).on('click', '.imgyulan1', function () {

            var imglist = $(this).parent().parent().find('div');
            var imgurl = $(this).attr('src');
            var imgstr = '';
            //alert(imglist)
            for (var i = 0; i < imglist.length; i++) {
                if (imgstr.length == 0) {
                    //console.log(imglist[i]);
                    imgstr += imglist[i].attributes['src'].value;
                } else {
                    imgstr += ',' + imglist[i].attributes['src'].value;
                }
            }
            wx.previewImage({
                current: imgurl,
                urls: imgstr.split(',')
            });
        })

    </script>



    <script type="text/javascript">
        $(function () {
            setInterval(Time, 1000);
            var currYear = (new Date()).getFullYear();
            var opt = {};
            opt.date = { preset: 'date' };
            //opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
            opt.datetime = { preset: 'datetime' };
            opt.time = { preset: 'time' };
            opt.default = {
                theme: 'android-ics light', //皮肤样式
                display: 'bottom', //显示方式
                mode: 'scroller', //日期选择模式
                lang: 'zh',
                startYear: currYear - 10, //开始年份
                endYear: currYear + 10 //结束年份
            };

             $("#appDate").val('').scroller('destroy').scroller($.extend(opt['date'], opt['default']));
            var optDateTime = $.extend(opt['datetime'], opt['default']);
            var optTime = $.extend(opt['time'], opt['default']);
            $("#appDateTime").mobiscroll(optDateTime).datetime(optDateTime);
        });

        //$('#applybtn[tag="1"]').css('background-color', '#ddd')
        function Time() {
            if ($('#appDateTime').val() != null && $('#appDateTime').val() != '') {
                //$('#applybtn').attr({ 'disabled': false }).css('background-color', '#4ca329')
            }
        }

        // 处理状态js
        $('.service li').click(function () {
            $(this).addClass('current').siblings().removeClass('current')
        })

        ///取消
        $('#applybtn1').click(function () {
            var reasontext = $('#reasontext').val();
            if (reasontext == null || reasontext == '') {
                $('#querentext').text('请填写原因!')
                return false;
            }
            $.post('@Url.Action("CancelJson","PhoneWeb")', { repairID: GetQueryString('repairid'), reason: reasontext }, function (data, status) {
                if (data.msg != 'N') {
                    windowlength = window.history.length;
                    //alert(windowlength);
                    if (windowlength == 1) {
                        window.localStorage['IndexLi'] = 3;
                        window.location.replace('@Url.Action("RepairInterior","PhoneWeb")?IndexLi=3');
                    } else {
                        window.localStorage['IndexLi'] = 3;
                        window.history.go(-1);
                    }


                }
            })
        })


        $('#modalquxiao').click(function () {
            $('#querentext').empty();
        })

        //微信多图轮播
        $('.imgyulan').click(function () {
            var imglist = $(this).parent().find('.imgyulan');
            var imgurl = $(this).attr('src');
            var imgstr = '';
            for (var i = 0; i < imglist.length; i++) {
                if (imgstr.length == 0) {
                    //console.log(imglist[i]);
                    imgstr += imglist[i].attributes['src'].value;
                } else {
                    imgstr += ',' + imglist[i].attributes['src'].value;
                }
            }
            wx.previewImage({
                current: imgurl,
                urls: imgstr.split(',')
            });
        })



    </script>


}
